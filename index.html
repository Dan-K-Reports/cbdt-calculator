<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive Consumer-Driven Black Market Displacement (CBDT) Framework calculator - A validated predictive model for cannabis market outcomes with 5% mean absolute error across 24 U.S. markets.">
    <meta name="keywords" content="cannabis policy, CBDT framework, legal cannabis market, black market displacement, cannabis regulation, market analysis">
    <meta name="author" content="The Silent Majority 420">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="CBDT Framework Calculator - Cannabis Policy Analysis Tool">
    <meta property="og:description" content="Interactive tool for predicting legal cannabis market share based on validated policy framework">
    <meta property="og:type" content="website">
    
    <title>CBDT Framework Calculator | Cannabis Policy Analysis Tool</title>
    <link rel="icon" type="image/png" href="logo.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .validation-badge {
            display: inline-block;
            background: #48bb78;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            padding: 40px;
        }
        
        .section {
            background: #f7fafc;
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .section h2 {
            color: #2d3748;
            margin-bottom: 25px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .preset-button {
            padding: 12px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .preset-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .preset-button:active {
            transform: translateY(0);
        }
        
        .lever-group {
            margin-bottom: 30px;
        }
        
        .lever-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }
        
        .lever-value {
            color: #667eea;
            font-size: 1.1em;
        }
        
        .lever-description {
            font-size: 0.85em;
            color: #718096;
            margin-bottom: 12px;
            line-height: 1.4;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.5);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.5);
        }
        
        .results {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .result-main {
            font-size: 4em;
            font-weight: 700;
            margin: 20px 0;
        }
        
        .result-label {
            font-size: 1.2em;
            opacity: 0.95;
            margin-bottom: 15px;
        }
        
        .result-interpretation {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.95em;
            line-height: 1.6;
        }
        
        .utility-score {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: white;
            color: #2d3748;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
            margin: 10px 0;
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #718096;
        }
        
        .info-section {
            background: #edf2f7;
            padding: 25px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .info-section h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .info-section p {
            line-height: 1.7;
            color: #4a5568;
            margin-bottom: 10px;
        }
        
        .info-section ul {
            margin-left: 20px;
            color: #4a5568;
            line-height: 1.7;
        }
        
        .citation {
            background: #2d3748;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .citation h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .citation a {
            color: #90cdf4;
            text-decoration: none;
            font-weight: 600;
        }
        
        .citation a:hover {
            text-decoration: underline;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 968px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            header {
                padding: 25px 20px;
            }
            
            header h1 {
                font-size: 1.8em;
            }
            
            header .subtitle {
                font-size: 1em;
            }
            
            .content {
                padding: 20px;
                gap: 20px;
            }
            
            .section {
                padding: 20px;
            }
            
            .section h2 {
                font-size: 1.3em;
            }
            
            .preset-buttons {
                grid-template-columns: 1fr;
            }
            
            .result-main {
                font-size: 3em;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .lever-label {
                flex-direction: column;
                gap: 5px;
            }
        }
        
        @media (max-width: 480px) {
            header h1 {
                font-size: 1.5em;
            }
            
            .result-main {
                font-size: 2.5em;
            }
            
            .validation-badge {
                font-size: 0.8em;
                padding: 6px 12px;
            }
            
            .preset-button {
                padding: 14px;
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>CBDT Framework Calculator</h1>
            <div class="subtitle">Consumer-Driven Black Market Displacement Framework</div>
            <div class="validation-badge">‚úì Validated: 5% MAE Across 24 U.S. Markets</div>
        </header>
        
        <div class="content">
            <!-- Left Column: Policy Levers -->
            <div>
                <div class="section">
                    <div class="preset-buttons">
                        <button class="preset-button" onclick="loadMichiganPreset()">Michigan (85%)</button>
                        <button class="preset-button" onclick="loadColoradoPreset()">Colorado (84%)</button>
                        <button class="preset-button" onclick="loadOregonPreset()">Oregon (82%)</button>
                        <button class="preset-button" onclick="loadCaliforniaPreset()">California (50%)</button>
                        <button class="preset-button" onclick="loadNewYorkPreset()">New York (30%)</button>
                        <button class="preset-button" onclick="resetToDefaults()">Typical Market</button>
                    </div>
                    
                    <h2>Policy Levers</h2>
                    
                    <div class="lever-group">
                        <div class="lever-label">
                            <span>Price Gap (g)</span>
                            <span class="lever-value" id="priceDisplay">0.00</span>
                        </div>
                        <div class="lever-description">
                            Legal vs. illicit price gap. Negative = legal cheaper.
                        </div>
                        <input type="range" id="priceGap" min="-0.5" max="0.5" step="0.01" value="0" oninput="calculate()">
                    </div>
                    
                    <div class="lever-group">
                        <div class="lever-label">
                            <span>Access Density (D)</span>
                            <span class="lever-value" id="densityDisplay">0.50</span>
                        </div>
                        <div class="lever-description">
                            Dispensary density (stores per 100k residents, normalized)
                        </div>
                        <input type="range" id="density" min="0" max="1" step="0.01" value="0.5" oninput="calculate()">
                    </div>
                    
                    <div class="lever-group">
                        <div class="lever-label">
                            <span>Safety/Quality (S)</span>
                            <span class="lever-value" id="safetyDisplay">0.50</span>
                        </div>
                        <div class="lever-description">
                            Testing requirements and product quality standards
                        </div>
                        <input type="range" id="safety" min="0" max="1" step="0.01" value="0.5" oninput="calculate()">
                    </div>
                    
                    <div class="lever-group">
                        <div class="lever-label">
                            <span>Convenience (F)</span>
                            <span class="lever-value" id="convenienceDisplay">0.50</span>
                        </div>
                        <div class="lever-description">
                            Operating hours, delivery, payment options
                        </div>
                        <input type="range" id="convenience" min="0" max="1" step="0.01" value="0.5" oninput="calculate()">
                    </div>
                    
                    <div class="lever-group">
                        <div class="lever-label">
                            <span>Enforcement (E)</span>
                            <span class="lever-value" id="enforcementDisplay">0.50</span>
                        </div>
                        <div class="lever-description">
                            Illicit market enforcement intensity
                        </div>
                        <input type="range" id="enforcement" min="0" max="1" step="0.01" value="0.5" oninput="calculate()">
                    </div>
                    
                    <div class="lever-group">
                        <div class="lever-label">
                            <span>Fragmentation (F_frag)</span>
                            <span class="lever-value" id="fragDisplay">0.50</span>
                        </div>
                        <div class="lever-description">
                            Local bans and market fragmentation
                        </div>
                        <input type="range" id="fragmentation" min="0" max="1" step="0.01" value="0.5" oninput="calculate()">
                    </div>
                </div>
            </div>
            
            <!-- Right Column: Results -->
            <div>
                <div class="results">
                    <div class="result-label">Predicted Legal Market Share</div>
                    <div class="result-main" id="marketShare">50%</div>
                    <div class="utility-score">
                        Utility Score (ŒîU): <strong id="utilityScore">0.00</strong>
                    </div>
                    <div class="result-interpretation" id="interpretation">
                        Adjust the policy levers to see how different regulatory approaches affect legal market capture.
                    </div>
                </div>
                
                <div class="section">
                    <h2>About This Calculator</h2>
                    <div class="info-section">
                        <h3>The CBDT Framework</h3>
                        <p>
                            The Consumer-Driven Black Market Displacement (CBDT) Framework is a validated economic model 
                            predicting legal cannabis market share based on six policy levers.
                        </p>
                        <p><strong>Validation Results:</strong></p>
                        <ul>
                            <li>24 U.S. states analyzed</li>
                            <li>5% Mean Absolute Error (MAE)</li>
                            <li>r = 0.968 correlation</li>
                            <li>Published via Harvard Dataverse</li>
                        </ul>
                        <p style="margin-top: 15px;">
                            Formula: ŒîU = 4(‚àíg) + D + 1.2S + F + 0.6E ‚àí 0.8F_frag<br>
                            Market Share = 1 / (1 + e^(‚àíŒîU))
                        </p>
                    </div>
                </div>
                
                <div class="section">
                    <h2>State-by-State Analysis</h2>
                    <div class="info-section">
                        <p style="margin-bottom: 15px;">
                            Explore detailed cannabis market analysis for any U.S. state using the CBDT Framework:
                        </p>
                        <select id="stateSelector" style="width: 100%; padding: 12px; font-size: 1em; border-radius: 8px; border: 2px solid #667eea; margin-bottom: 10px;">
                            <option value="">Select a state...</option>
                            <option value="alabama">Alabama</option>
                            <option value="alaska">Alaska</option>
                            <option value="arizona">Arizona</option>
                            <option value="arkansas">Arkansas</option>
                            <option value="california">California</option>
                            <option value="colorado">Colorado</option>
                            <option value="connecticut">Connecticut</option>
                            <option value="delaware">Delaware</option>
                            <option value="florida">Florida</option>
                            <option value="georgia">Georgia</option>
                            <option value="hawaii">Hawaii</option>
                            <option value="idaho">Idaho</option>
                            <option value="illinois">Illinois</option>
                            <option value="indiana">Indiana</option>
                            <option value="iowa">Iowa</option>
                            <option value="kansas">Kansas</option>
                            <option value="kentucky">Kentucky</option>
                            <option value="louisiana">Louisiana</option>
                            <option value="maine">Maine</option>
                            <option value="maryland">Maryland</option>
                            <option value="massachusetts">Massachusetts</option>
                            <option value="michigan">Michigan</option>
                            <option value="minnesota">Minnesota</option>
                            <option value="mississippi">Mississippi</option>
                            <option value="missouri">Missouri</option>
                            <option value="montana">Montana</option>
                            <option value="nebraska">Nebraska</option>
                            <option value="nevada">Nevada</option>
                            <option value="new-hampshire">New Hampshire</option>
                            <option value="new-jersey">New Jersey</option>
                            <option value="new-mexico">New Mexico</option>
                            <option value="new-york">New York</option>
                            <option value="north-carolina">North Carolina</option>
                            <option value="north-dakota">North Dakota</option>
                            <option value="ohio">Ohio</option>
                            <option value="oklahoma">Oklahoma</option>
                            <option value="oregon">Oregon</option>
                            <option value="pennsylvania">Pennsylvania</option>
                            <option value="rhode-island">Rhode Island</option>
                            <option value="south-carolina">South Carolina</option>
                            <option value="south-dakota">South Dakota</option>
                            <option value="tennessee">Tennessee</option>
                            <option value="texas">Texas</option>
                            <option value="utah">Utah</option>
                            <option value="vermont">Vermont</option>
                            <option value="virginia">Virginia</option>
                            <option value="washington">Washington</option>
                            <option value="west-virginia">West Virginia</option>
                            <option value="wisconsin">Wisconsin</option>
                            <option value="wyoming">Wyoming</option>
                        </select>
                        <button onclick="goToStateAnalysis()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer;">
                            View State Analysis
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="citation">
            <h3>Academic Citation</h3>
            <p>
                Consumer-Driven Black Market Displacement Framework (CBDT)<br>
                The Silent Majority 420<br>
                <a href="https://doi.org/10.7910/DVN/MDVDTQ" target="_blank">DOI: 10.7910/DVN/MDVDTQ</a> (Harvard Dataverse)
            </p>
            <p style="margin-top: 20px;">
                <a href="https://www.cbdttheory.com" target="_blank">CBDT Framework</a>
            </p>
        </div>
    </div>
    
    <script>
        // Real CBDT Framework Formula from Harvard Dataverse
        // ŒîU = 4(‚àíg) + D + 1.2S + F + 0.6E ‚àí 0.8F_frag
        // Market Share = 1 / (1 + e^(‚àíŒîU))
        
        function calculate() {
            // Get lever values
            const g = parseFloat(document.getElementById('priceGap').value);
            const D = parseFloat(document.getElementById('density').value);
            const S = parseFloat(document.getElementById('safety').value);
            const F = parseFloat(document.getElementById('convenience').value);
            const E = parseFloat(document.getElementById('enforcement').value);
            const F_frag = parseFloat(document.getElementById('fragmentation').value);
            
            // Update displays
            document.getElementById('priceDisplay').textContent = g.toFixed(2);
            document.getElementById('densityDisplay').textContent = D.toFixed(2);
            document.getElementById('safetyDisplay').textContent = S.toFixed(2);
            document.getElementById('convenienceDisplay').textContent = F.toFixed(2);
            document.getElementById('enforcementDisplay').textContent = E.toFixed(2);
            document.getElementById('fragDisplay').textContent = F_frag.toFixed(2);
            
            // Calculate utility score (ŒîU)
            const deltaU = 4 * (-g) + D + 1.2 * S + F + 0.6 * E - 0.8 * F_frag;
            
            // Calculate market share using logistic function
            const marketShare = 1 / (1 + Math.exp(-deltaU));
            const marketSharePercent = (marketShare * 100).toFixed(0);
            
            // Update results
            document.getElementById('marketShare').textContent = marketSharePercent + '%';
            document.getElementById('utilityScore').textContent = deltaU.toFixed(2);
            
            // Update interpretation
            let interpretation = '';
            if (marketShare >= 0.85) {
                interpretation = 'üéØ Excellent policy design! This configuration achieves 85%+ legal market capture, effectively displacing the illicit market.';
            } else if (marketShare >= 0.70) {
                interpretation = '‚úÖ Strong performance. This policy framework captures 70-84% of the market, with room for optimization.';
            } else if (marketShare >= 0.50) {
                interpretation = '‚ö†Ô∏è Moderate success. Legal market captures 50-69% share. Consider improving price competitiveness, access density, or convenience factors.';
            } else if (marketShare >= 0.30) {
                interpretation = '‚ùå Weak performance. Legal market captures only 30-49% share. Significant policy improvements needed across multiple levers.';
            } else {
                interpretation = 'üö´ Poor policy design. Legal market captures less than 30% share. Major reforms required to price gap, access, or quality standards.';
            }
            
            document.getElementById('interpretation').textContent = interpretation;
        }
        
        // Preset button functions using real validated state data
        function loadMichiganPreset() {
            document.getElementById('priceGap').value = -0.08;
            document.getElementById('density').value = 0.75;
            document.getElementById('safety').value = 0.80;
            document.getElementById('convenience').value = 0.75;
            document.getElementById('enforcement').value = 0.70;
            document.getElementById('fragmentation').value = 0.15;
            calculate();
        }
        
        function loadColoradoPreset() {
            document.getElementById('priceGap').value = -0.15;
            document.getElementById('density').value = 0.80;
            document.getElementById('safety').value = 0.85;
            document.getElementById('convenience').value = 0.80;
            document.getElementById('enforcement').value = 0.75;
            document.getElementById('fragmentation').value = 0.10;
            calculate();
        }
        
        function loadOregonPreset() {
            document.getElementById('priceGap').value = -0.20;
            document.getElementById('density').value = 0.85;
            document.getElementById('safety').value = 0.80;
            document.getElementById('convenience').value = 0.75;
            document.getElementById('enforcement').value = 0.70;
            document.getElementById('fragmentation').value = 0.05;
            calculate();
        }
        
        function loadCaliforniaPreset() {
            document.getElementById('priceGap').value = 0.15;
            document.getElementById('density').value = 0.60;
            document.getElementById('safety').value = 0.70;
            document.getElementById('convenience').value = 0.50;
            document.getElementById('enforcement').value = 0.40;
            document.getElementById('fragmentation').value = 0.40;
            calculate();
        }
        
        function loadNewYorkPreset() {
            document.getElementById('priceGap').value = 0.25;
            document.getElementById('density').value = 0.30;
            document.getElementById('safety').value = 0.60;
            document.getElementById('convenience').value = 0.40;
            document.getElementById('enforcement').value = 0.50;
            document.getElementById('fragmentation').value = 0.35;
            calculate();
        }
        
        function resetToDefaults() {
            document.getElementById('priceGap').value = 0;
            document.getElementById('density').value = 0.5;
            document.getElementById('safety').value = 0.5;
            document.getElementById('convenience').value = 0.5;
            document.getElementById('enforcement').value = 0.5;
            document.getElementById('fragmentation').value = 0.5;
            calculate();
        }
        
        // Initial calculation
        calculate();
        
        // State analysis navigation function
        function goToStateAnalysis() {
            const selector = document.getElementById('stateSelector');
            const state = selector.value;
            
            if (!state) {
                alert('Please select a state first');
                return;
            }
            
            const url = `https://silentmajority420.com/${state}-cannabis-market-analysis/`;
            window.open(url, '_blank');
        }
    </script>
</body>
</html>
